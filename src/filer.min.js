var self=this;self.URL=self.URL||self.webkitURL;self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem;self.resolveLocalFileSystemURL=self.resolveLocalFileSystemURL||self.webkitResolveLocalFileSystemURL;navigator.temporaryStorage=navigator.temporaryStorage||navigator.webkitTemporaryStorage;navigator.persistentStorage=navigator.persistentStorage||navigator.webkitPersistentStorage;self.BlobBuilder=self.BlobBuilder||self.MozBlobBuilder||self.WebKitBlobBuilder;
if(void 0===self.FileError){var FileError=function(){};FileError.prototype.prototype=Error.prototype}
var Util={toArray:function(a){return Array.prototype.slice.call(a||[],0)},strToDataURL:function(a,b,c){return(void 0!=c?c:1)?"data:"+b+";base64,"+self.btoa(a):"data:"+b+","+a},strToObjectURL:function(a,b){for(var c=new Uint8Array(a.length),d=0;d<c.length;++d)c[d]=a.charCodeAt(d);c=new Blob([c],b?{type:b}:{});return self.URL.createObjectURL(c)},fileToObjectURL:function(a){return self.URL.createObjectURL(a)},fileToArrayBuffer:function(a,b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)};
d.onerror=function(a){c&&c(a)};d.readAsArrayBuffer(a)},dataURLToBlob:function(a){if(-1==a.indexOf(";base64,")){var b=a.split(","),a=b[0].split(":")[1],b=b[1];return new Blob([b],{type:a})}for(var b=a.split(";base64,"),a=b[0].split(":")[1],b=window.atob(b[1]),c=b.length,d=new Uint8Array(c),j=0;j<c;++j)d[j]=b.charCodeAt(j);return new Blob([d],{type:a})},arrayBufferToBlob:function(a,b){var c=new Uint8Array(a);return new Blob([c],b?{type:b}:{})},arrayBufferToBinaryString:function(a,b,c){var d=new FileReader;
d.onload=function(a){b(a.target.result)};d.onerror=function(a){c&&c(a)};a=new Uint8Array(a);d.readAsBinaryString(new Blob([a]))},arrayToBinaryString:function(a){if("object"!=typeof a)return null;for(var b=a.length,c=Array(b);b--;)c[b]=String.fromCharCode(a[b]);return c.join("")},getFileExtension:function(a){var b=a.lastIndexOf(".");return-1!=b?a.substring(b):""}},MyFileError=function(a){this.prototype=FileError.prototype;this.code=a.code;this.name=a.name};FileError.BROWSER_NOT_SUPPORTED=1E3;
FileError.prototype.__defineGetter__("name",function(){for(var a=Object.keys(FileError),b=0,c;c=a[b];++b)if(FileError[c]==this.code)return c;return"Unknown Error"});
var Filer=new function(){function a(e){if(b=e||null)c=b.root,d=!0}var b=null,c=null,d=!1,j=function(e){return 0==e.indexOf("filesystem:")},k=function(e){j(e)||(e="/"==e[0]?b.root.toURL()+e.substring(1):0==e.indexOf("./")||0==e.indexOf("../")?"../"==e&&c!=b.root?c.toURL()+"/"+e:c.toURL()+e:c.toURL()+"/"+e);return e},m=function(e,a,b){var f=a[0],c=a[1],l=function(e){var a=null,a=e.code==FileError.NOT_FOUND_ERR?c?Error('"'+f+'" or "'+c+'" does not exist.'):Error('"'+f+'" does not exist.'):Error("Problem getting Entry for one or more paths.");
if(b)b(a);else throw a;},d=k(f);if(2==a.length){var n=k(c);self.resolveLocalFileSystemURL(d,function(a){self.resolveLocalFileSystemURL(n,function(b){e(a,b)},l)},l)}else self.resolveLocalFileSystemURL(d,e,l)},p=function(e,a,c,f,h,l){if(!b)throw Error("Filesystem has not been initialized.");if(typeof e!=typeof a)throw Error("These method arguments are not supported.");var d=c||null,n=void 0!=l?l:!1;(e.isFile||a.isDirectory)&&a.isDirectory?n?e.moveTo(a,d,f,h):e.copyTo(a,d,f,h):m(function(a,e){if(e.isDirectory)n?
a.moveTo(e,d,f,h):a.copyTo(e,d,f,h);else{var b=Error('Oops! "'+e.name+" is not a directory!");if(h)h(b);else throw b;}},[e,a],h)};a.DEFAULT_FS_SIZE=1048576;a.version="0.4.1";a.prototype={get fs(){return b},get isOpen(){return d},get cwd(){return c}};a.prototype.pathToFilesystemURL=function(a){return k(a)};a.prototype.init=function(a,i,g){if(!self.requestFileSystem)throw new MyFileError({code:FileError.BROWSER_NOT_SUPPORTED,name:"BROWSER_NOT_SUPPORTED"});var a=a?a:{},f=a.size||1048576;this.type=self.TEMPORARY;
if("persistent"in a&&a.persistent)this.type=self.PERSISTENT;var h=function(a){this.size=f;b=a;c=b.root;d=!0;i&&i(a)};this.type==self.PERSISTENT&&navigator.persistentStorage?navigator.persistentStorage.requestQuota(f,function(a){self.requestFileSystem(this.type,a,h.bind(this),g)}.bind(this),g):self.requestFileSystem(this.type,f,h.bind(this),g)};a.prototype.ls=function(a,i,g){if(!b)throw Error("Filesystem has not been initialized.");var f=function(a){c=a;var e=[],b=c.createReader(),f=function(){b.readEntries(function(a){a.length?
(e=e.concat(Util.toArray(a)),f()):(e.sort(function(a,e){return a.name<e.name?-1:e.name<a.name?1:0}),i(e))},g)};f()};a.isDirectory?f(a):j(a)?m(f,[k(a)],g):c.getDirectory(a,{},f,g)};a.prototype.mkdir=function(a,i,g,f){if(!b)throw Error("Filesystem has not been initialized.");var h=null!=i?i:!1,d=a.split("/"),o=function(b,c){if("."==c[0]||""==c[0])c=c.slice(1);b.getDirectory(c[0],{create:!0,exclusive:h},function(b){if(b.isDirectory)c.length&&1!=d.length?o(b,c.slice(1)):g&&g(b);else if(b=Error(a+" is not a directory"),
f)f(b);else throw b;},function(b){if(b.code==FileError.INVALID_MODIFICATION_ERR)if(b.message="'"+a+"' already exists",f)f(b);else throw b;})};o(c,d)};a.prototype.open=function(a,c,g){if(!b)throw Error("Filesystem has not been initialized.");a.isFile?a.file(c,g):m(function(a){a.file(c,g)},[k(a)],g)};a.prototype.create=function(a,i,g,f){if(!b)throw Error("Filesystem has not been initialized.");c.getFile(a,{create:!0,exclusive:null!=i?i:!0},g,function(b){if(b.code==FileError.INVALID_MODIFICATION_ERR)b.message=
"'"+a+"' already exists";if(f)f(b);else throw b;})};a.prototype.mv=function(a,b,c,f,d){p.bind(this,a,b,c,f,d,!0)()};a.prototype.rm=function(a,c,g){if(!b)throw Error("Filesystem has not been initialized.");var f=function(a){a.isFile?a.remove(c,g):a.isDirectory&&a.removeRecursively(c,g)};a.isFile||a.isDirectory?f(a):m(f,[a],g)};a.prototype.cd=function(a,d,g){if(!b)throw Error("Filesystem has not been initialized.");a.isDirectory?(c=a,d&&d(c)):(a=k(a),m(function(a){if(a.isDirectory)c=a,d&&d(c);else if(a=
Error("Path was not a directory."),g)g(a);else throw a;},[a],g))};a.prototype.cp=function(a,b,c,f,d){p.bind(this,a,b,c,f,d)()};a.prototype.write=function(a,d,g,f){if(!b)throw Error("Filesystem has not been initialized.");var h=function(a){a.createWriter(function(b){b.onerror=f;if(d.append)b.onwriteend=function(){g&&g(a,this)},b.seek(b.length);else{var c=!1;b.onwriteend=function(){c?g&&g(a,this):(c=!0,this.truncate(this.position))}}if(d.data.__proto__==ArrayBuffer.prototype)d.data=new Uint8Array(d.data);
var e=new Blob([d.data],d.type?{type:d.type}:{});b.write(e)},f)};a.isFile?h(a):j(a)?m(h,[a],f):c.getFile(a,{create:!0,exclusive:!1},h,f)};a.prototype.df=function(a,b){var c=function(b,c){a(b,c-b,c)};self.TEMPORARY==this.type?navigator.webkitTemporaryStorage.queryUsageAndQuota(c,b):self.PERSISTENT==this.type&&navigator.webkitPersistentStorage.queryUsageAndQuota(c,b)};return a};
